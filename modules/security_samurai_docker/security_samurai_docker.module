<?php
/**
 * @file
 * security_samurai_docker.module 
 */

/**
 * Implements hook_menu
 */
function security_samurai_docker_menu() {
  $items = array();

  // Docker administration configuration page.
  $items['admin/config/development/docker'] = array(
    'title' => t('Docker configuration'),
    'description' => 'Configuration settings related to docker container setups.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('security_samurai_docker_admin_config_form'),
    'access arguments' => array('administer samurai docker'),
    'file' => 'security_samurai_docker.admin.inc',
  );

  return $items;
}

/**
 * Implements hook_permission()
 */
function security_samurai_docker_permission() {
  return array(
    'administer samurai docker' => array(
      'title' => t('Administer security samurai docker'),
      'description' => t('Perform administration tasks for security samurai docker.'),
    ),
  );
}

/**
 * Implements hook_form_alter()
 */
function security_samurai_docker_form_alter(&$form) {

  // Override the client form and add in some extra configuration options.
  if ($form['#form_id'] == 'client_site_form') {
    $docker_form_items = array();

    $docker_form_items['docker_client_form_fieldset'] = array(
      '#type' => 'fieldset',
      '#title' => t('Docker configuration'),
      '#description' => t('Docker is used for creating test environments when applying the security updates. The below configuration options are custom to this client.'),
    );

    $docker_form_items['docker_client_form_fieldset']['docker_client_form_pre_install'] = array(
      '#type' => 'textfield',
      '#title' => t('Pre-Drupal installation script'),
      '#description' => t('Link to a script to run before the Drupal installation has been set up. Accepts Git URLs, if the repo is private please make sure you have correctly configured the API keys and account.'),
    );

    $docker_form_items['docker_client_form_fieldset']['docker_client_form_post_install'] = array(
      '#type' => 'textfield',
      '#title' => t('Post-Drupal installation script'),
      '#description' => t('Link to a script to run after the Drupal installation has been set up. Accepts Git URLs, if the repo is private please make sure you have correctly configured the API keys and account.'),
    );

    $form = array_merge($form, $docker_form_items);
  }
}